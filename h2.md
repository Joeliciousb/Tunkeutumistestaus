# Täysin laillinen sertifikaatti

---

## Tiivistelmät

### OWASP Top 10: Broken Access Control

- Yleisin riski OWASP Top 10: 2021 listassa
- Access Control tarkoittaa periaatetta, että käyttäjä voi toimia vain käyttäjälle tarkoitettujen oikeuksien mukaan.
- Sovelluksen tulisi varmistaa, että käyttäjä on kuka hänen luullaan olevan eikä vain olettaa niin.
- Yleisiä hyökkäyksiä ovat "force browsing" ja parametrien muokkaus
  - Esimerkiksi adminpaneelin tulisi olla näkyvä vain admin-käyttäjille, mutta tarkistaako sovellus käyttäjän oikeudet, jos navigoi /admin päätepisteeseen?
  - Jos käyttäjä muokkaa kyselyn parametreja, voiko hän saada jonkun toisen käyttäjän tiedot näkyviin.

### OWASP Top 10: Server Side Request Forgery (SSRF)

- Sijalla #10 OWASP Top 10: 2021 listassa
- Hyökkääjä voi huijata palvelimen tekemään pyyntöjän paikkoihin esimerkiksi sisäisiin verkkoihin
- Sovellus on haavoittunut, jos se hyväksyy käyttäjän syöttämän URL-osoitteen sellaisenaan
- Hyökkääjä voi hakea hyödyntää haavoittuvuutta lähettämällä pyynnön esimerkiksi localhost:28017/ tai muihin sisäverkon päätepisteisiin

### PortSwigger Academy Insecure Direct Object Reference (IDOR)

- Kun sovellus käyttää käyttäjän antamaa syötettä suoraan sellaisenaan olioiden käsittelyssä
- Esimerkiksi sivu, joka näyttää käyttäjän tiedot osoitteessa ```https://example/customer?customer_id=1```
   - Mitä jos id arvon vaihtaa, näkeekö toisen käyttäjän tiedot?
- Sama pätee myös tiedostejen lukemisessa: ```https://example/static/101.txt```

### PortSwigger Academy Path Traversal

- Hyökkäys, joka mahdollistaa tiedostojen lukemisen, joihin ei normaalisti olisi pääsyä
- Esimerkiksi HTML-sivu voi ladata kuvan koodilla ```<img src="/loadImage?filename=218.png">```
  - Mitä jos hyökkääjä muokkaa filename arvon ```../../../etc/passwd```?
  - Tämä palauttaisi tiedoston, josta hyökkääjä näkisi käyttäjien tietoja
- Paras tapa suojautua on välttää syöttämästä käyttäjän syötettä suoraan rajapintoihin

### PortSwigger Academy Server-side Request Forgery (SSRF)

- Hyökkäys, jossa hyökkääjä huijaa palvelinta lähettämään pyyntöjä kohteisiin, joihin hyökkääjä ei normaalisti pääsisi itse
- Sovellukset voivat olla turhan sinisilmäisiä pyyntöihin, jotka tulevat sisäverkosta
- Esimerkiksi palvelin lähettää pyynnön sisäverkkoon, joka hakee tuotteen myymäläsaatavuuden
  - Hyökkääjä muuttaa pyynnön sisältöä, jotta pyyntö hakeekin ```localhost/admin``` näkymän

### PortSwigger Academy Cross-site Scripting (XSS)

- Hyökkäys, jossa syötetään haitallista JavaScript-koodia käyttäjän selaimeen
- Kolme päätyyppiä: Reflected XSS, Stored XSS ja DOM-based XSS
  - Reflected XSS hyökkäyksissä haitallinen koodi toimitetaan esimerkiksi URL-osoitten kautta
  - Stored XSS hyökkäyksissä haitallinen koodi tulee suoraan palvelimelta, esimerkiksi käyttäjän kommentti keskustelupalstalla
  - DOM-based XSS 

---

## Totally legit certificate

Zapin asennus komennolla ```sudo apt-get install zaproxy```

![image](https://github.com/user-attachments/assets/3f318257-9ce5-43f8-8ff7-b77e9fb0c282)

Avataan Zap ja mennään ```Tools > Options```

![image](https://github.com/user-attachments/assets/39ddf72a-7177-4a7f-9ac4-24c0d8fcd15e)

Haetaan sertifikaatti

![image](https://github.com/user-attachments/assets/a6c566c3-3362-4cb4-9c5d-1c6c7bdd966c)

Tallennetaan sertifikaatti

![image](https://github.com/user-attachments/assets/cf696bb8-badd-48f7-9e83-65f523175450)

Mennään selaimen asetuksiin

![image](https://github.com/user-attachments/assets/f9a4e130-b0bb-4d52-88cf-4132c656d0ee)

Importataan tallennettu sertifikaatti

![image](https://github.com/user-attachments/assets/66d5ee05-be93-463b-9213-8a6639ce5206)

![image](https://github.com/user-attachments/assets/6410617d-0163-4819-a711-bcd7778024cb)

![image](https://github.com/user-attachments/assets/8d936617-c3b5-45b8-9345-fda672193bbf)

Laitetaan ZAP vielä käsittelemään kuvia asetuksista: ```Tools > Options > Display```.

![image](https://github.com/user-attachments/assets/fc7c24a2-861f-4151-a992-50715041fc14)

Vaihdetaan selaimen proxy asetuksia

![image](https://github.com/user-attachments/assets/21e3c173-4a84-4a9f-8013-4d6ee8e3898d)

![image](https://github.com/user-attachments/assets/d782ffe3-8a49-485e-a824-889b5e3f3c4f)

Nyt näemme, että proxy kaappaa liikennettä

![image](https://github.com/user-attachments/assets/751176c2-6059-4b77-a998-6d03a1c47fbe)

---

## FoxyProxy

Asennetaan FoxyProxy extension

![image](https://github.com/user-attachments/assets/5431a040-8053-480c-ae0f-97b7dce9b9a8)

Muokataan ```proxies > localhost```. Lisätään sinne kaksi patternia:
- Ensimmäisen tyyppi on `Reg Exp` ja pattern `https://portswigger.net`
- Toisen tyyppi on `Wildcard` ja pattern `*://localhost/*`

![image](https://github.com/user-attachments/assets/19494831-a4b1-47b6-bdc8-b9addef6429e)

Laitetaan FoxyProxyn asetus "Proxy by Patterns" päälle.

![image](https://github.com/user-attachments/assets/4db41f1b-f400-4a8a-8ed3-b286e5e2d5d5)

Nyt proxyyn tulee näkyviin liikkeet vain osoitteessa ```https://portswigger.net``` tai ```localhost```. 

---

## PortSwigger Labs

### Cross Site Scripting (XSS)

### Path traversal

### Insecure Direct Object Reference (IDOR)

### Server Side Request Forgery (SSRF)

### Server Side Template Injection (SSTI)

--- 

## Lähteet

Karvinen Tero, Tunkeutumistestaus, luettavissa https://terokarvinen.com/tunkeutumistestaus/, luettu 4.4.2025

OWASP Top 10: 2021, Broken Access Control, luettavissa https://owasp.org/Top10/A01_2021-Broken_Access_Control/, luettu 4.4.2025

OWASP Top 10: 2021, Server Side Request Forgery (SSRF), luettavissa https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/, luettu 4.4.2025

PortSwigger, Web Security Academy, Insecure Direct Object Reference, luettavissa https://portswigger.net/web-security/access-control/idor, luettu 4.4.2025

PortSwigger, Web Security Academy, Path Traversal, luettavissa https://portswigger.net/web-security/file-path-traversal, luettu 4.4.2025

PortSwigger, Web Security Academy, Server Side Request Forgery, luettavissa https://portswigger.net/web-security/ssrf, luettu 4.4.2025

PortSwigger, Web Security Academy, Cross-site Scripting, luettavissa: https://portswigger.net/web-security/cross-site-scripting, luettu 4.4.2025

FoxyProxy, URL Patterns, luettavissa https://help.getfoxyproxy.org/index.php/knowledge-base/url-patterns/, luettu 4.4.2025






